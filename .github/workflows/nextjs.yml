# Nome do Workflow: Implanta um site Next.js no Deno Deploy
name: Deploy Next.js site to Deno Deploy

on:
  # Executa em pushes para a branch "main"
  push:
    branches: ["main"]
  # Permite que você execute este workflow manualmente na aba Actions
  workflow_dispatch:

# Define as permissões necessárias para o token do Deno Deploy
permissions:
  contents: read
  id-token: write # Essencial para a autenticação com o Deno Deploy

jobs:
  # Job único para compilar e fazer o deploy
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v4

      - name: Configurar Deno
        # Usa a action oficial do Deno
        uses: denoland/setup-deno@v1
        with:
          deno-version: v1.x # 'v1.x' usa a última versão estável

      # O passo de compilação do Next.js agora é gerenciado pelo Deno Deploy
      # e geralmente não é necessário um passo explícito de `npm run build` aqui,
      # a menos que seu projeto tenha passos de pré-compilação muito específicos.
      # O Deno Deploy irá compilar o projeto na nuvem.

      - name: Deploy para o Deno Deploy
        uses: denoland/deploy-action@v1
        with:
          # O nome do seu projeto no Deno Deploy
          # Substitua 'seu-projeto-aqui' pelo nome real do seu projeto
          project: "seu-projeto-aqui"

          # O arquivo de entrada principal da sua aplicação
          entrypoint: "main.ts" # Ou o nome do seu arquivo principal

          # O diretório raiz do seu projeto (geralmente não precisa mudar)
          root: "."
